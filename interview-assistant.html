<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ì‹¤ì‹œê°„ ì¸í„°ë·° ë¹„ì„œ</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; background: #f9f9f9; }
    h1 { color: #333; }
    #transcript, #response { background: white; padding: 1rem; border: 1px solid #ccc; margin-top: 1rem; white-space: pre-wrap; }
    button { padding: 0.5rem 1rem; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>ğŸ¤ ì‹¤ì‹œê°„ ì¸í„°ë·° ë¹„ì„œ (STT + GPT ìš”ì•½)</h1>
  <button onclick="startRecognition()">ìŒì„± ì¸ì‹ ì‹œì‘</button>
  <div id="transcript">[ì‹¤ì‹œê°„ ìŒì„± í…ìŠ¤íŠ¸]</div>
  <div id="response">[GPT ìš”ì•½/ì§ˆë¬¸ ê²°ê³¼]</div>

  <script>
    let finalTranscript = '';
    let recognition;

    function startRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.lang = 'ko-KR';
      recognition.interimResults = true;
      recognition.continuous = true;

      recognition.onresult = async (event) => {
        let interim = '';
        for (let i = event.resultIndex; i < event.results.length; ++i) {
          const transcript = event.results[i][0].transcript;
          if (event.results[i].isFinal) {
            finalTranscript += transcript + '\n';
            document.getElementById('transcript').innerText = finalTranscript;
            await sendToGPT(transcript);  // ìµœì‹  ë¬¸ì¥ë§Œ ë³´ë‚´ê¸°
          } else {
            interim += transcript;
          }
        }
      };

      recognition.onerror = (event) => {
        alert('ìŒì„± ì¸ì‹ ì˜¤ë¥˜: ' + event.error);
      };

      recognition.start();
    }

    async function sendToGPT(text) {
      const responseBox = document.getElementById('response');
      responseBox.innerText = '[GPT ì²˜ë¦¬ ì¤‘...]';

      const payload = {
        model: "gpt-4",
        messages: [
          { role: "system", content: "ë„ˆëŠ” ì¸í„°ë·° ë³´ì¡°ì•¼. ì•„ë˜ ë‚´ìš©ì„ ìš”ì•½í•˜ê³ , í›„ì† ì§ˆë¬¸ì„ 2ê°œ ì¶”ì²œí•´ì¤˜. ì¤‘ìš”í•œ ìš©ì–´ëŠ” í•œê¸€ë¡œ ë³‘ê¸°í•´ì¤˜." },
          { role: "user", content: text }
        ]
      };

      const res = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Authorization": "Bearer YOUR_API_KEY_HERE",  // â† ì—¬ê¸° API í‚¤ ì…ë ¥
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      const data = await res.json();
      const result = data.choices?.[0]?.message?.content || 'GPT ì‘ë‹µ ì—†ìŒ';
      responseBox.innerText = result;
    }
  </script>
</body>
</html>
